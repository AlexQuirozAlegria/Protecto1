create database Automotriz;
use Automotriz;


CREATE TABLE Clientes (
    idCliente INT AUTO_INCREMENT PRIMARY KEY,
    rfc VARCHAR(13) UNIQUE,
    nombre VARCHAR(50),
    apellidoP VARCHAR(50),
    apellidoM VARCHAR(50),
    calle VARCHAR(100),
    numero VARCHAR(10),
    colonia VARCHAR(50),
    cp VARCHAR(5),
    ciudad VARCHAR(50),
    telefono1 VARCHAR(15),
    telefono2 VARCHAR(15),
    telefono3 VARCHAR(15),
    email VARCHAR(100),
    fecha_registro DATE
);



CREATE TABLE Vehiculos (
    num_serie VARCHAR(20) PRIMARY KEY,
    placas VARCHAR(10) NOT NULL,
    marca VARCHAR(50) NOT NULL,
    modelo VARCHAR(50) NOT NULL,
    anio INT NOT NULL,
    color VARCHAR(30),
    kilometraje INT NOT NULL,
    tipo VARCHAR(30),
antiguedad INT DEFAULT (YEAR(CURRENT_DATE) - anio),
    idcliente INT NOT NULL,
    FOREIGN KEY (idcliente) REFERENCES Clientes(idCliente)
);

CREATE TABLE Mecanicos (
    num_empleado INT AUTO_INCREMENT PRIMARY KEY,
    rfc VARCHAR(13) NOT NULL,
    nombre_completo VARCHAR(150) NOT NULL,
    especialidades VARCHAR(200),
    telefono VARCHAR(20),
    salario DECIMAL(10, 2),
    anios_experiencia INT
);

CREATE TABLE Servicios (
    clave_servicio INT AUTO_INCREMENT PRIMARY KEY,
    nombre_servicio VARCHAR(100) NOT NULL,
    descripcion TEXT,
    costo_base DECIMAL(10, 2) NOT NULL,
    tiempo_estimado INT
);

CREATE TABLE Refacciones (
    codigo_refaccion VARCHAR(20) PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    marca VARCHAR(50),
    precio_unitario DECIMAL(10, 2) NOT NULL,
    stock_actual INT NOT NULL,
    stock_minimo INT NOT NULL,
    proveedor VARCHAR(100)
);
CREATE TABLE Ordenes_Servicio (
    folio_orden INT AUTO_INCREMENT PRIMARY KEY,
    fecha_ingreso DATETIME NOT NULL,
    fecha_estimada_entrega DATETIME,
    fecha_real_entrega DATETIME,
    estado ENUM('abierta', 'en proceso', 'finalizada', 'cancelada'),
    costo_total DECIMAL(12, 2),
    num_serie VARCHAR(20) NOT NULL,
    FOREIGN KEY (num_serie) REFERENCES Vehiculos(num_serie)
);

CREATE TABLE Detalle_Orden_Mecanicos (
    folio_orden INT,
    num_empleado INT,
    PRIMARY KEY (folio_orden, num_empleado),
    FOREIGN KEY (folio_orden) REFERENCES Ordenes_Servicio(folio_orden),
    FOREIGN KEY (num_empleado) REFERENCES Mecanicos(num_empleado)
);

CREATE TABLE Detalle_Orden_Servicios (
    folio_orden INT,
    clave_servicio INT,
    PRIMARY KEY (folio_orden, clave_servicio),
    FOREIGN KEY (folio_orden) REFERENCES Ordenes_Servicio(folio_orden),
    FOREIGN KEY (clave_servicio) REFERENCES Servicios(clave_servicio)
);

CREATE TABLE Detalle_Orden_Refacciones (
    folio_orden INT,
    codigo_refaccion VARCHAR(20),
    cantidad INT,
    PRIMARY KEY (folio_orden, codigo_refaccion),
    FOREIGN KEY (folio_orden) REFERENCES Ordenes_Servicio(folio_orden),
    FOREIGN KEY (codigo_refaccion) REFERENCES Refacciones(codigo_refaccion)
);
